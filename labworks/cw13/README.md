# Лабораторная работа №3. Отладка приложения

## Цель работы

Приобрести навыки в отладке приложений на C/C++/C# на примере IDE Microsoft Visual Studio.

## Для чего нужна отладка?

Сейчас трудно представить мир без ошибок в программном обеспечении.
Веб-приложения выходят из строя, аварийно завершаются программы, мобильные приложения ведут себя не так, как планировалось и т.д.
Наличие ошибок (_багов_), к сожалению, неотвратимая цена за использование прорывных технологий.
В погоне за прибылью от программистов требуется написание исходного кода с максимально допустимой скоростью.

Конечно, не всё так плохо, как может показаться.
Существует множество методологий разработки ПО, при которых количество ошибок минимизируется.
Например, при подходе TDD сначала формируется набор тестов, а затем уже программируется некоторая функциональность.

Кстати, не всегда ошибки - это только аварийное завершение приложения.
Ошибкой также может являться такое поведение ПО, которое не ожидалось.
Например, если при воспроизведении музыки в мобильном приложении вдруг запускается фронтальная камера - это очевидная ошибка, хотя приложение и не "упало".

Вы наверняка замечали, что если в вашем коде какой-нибудь лабораторной работы встречается ошибка, преподаватель её находит довольно быстро.
Зачастую это связано с тем, что преподаватель при взгляде на исходный код "проигрывает" его, как бы это сделал компьютер.
Таким образом, ошибка сразу возникает в голове.

Однако это не означает, что для избавления от ошибок в исходном коде требуется развивать навык метальной компиляции.

В современных интегрированных средах разработки (_IDE_), к которым относится, например, Microsoft Visual Studio, существуют инструменты для проведения такой отладки (_debug_).

> Кстати, ошибка (или баг) происходит от слова _bug_, что означает... "жук"!
> Существует задокументированная история, когда в огромную ЭВМ (тогда они были размером в несколько шкафов) в одно из электромеханических реле попал мотылёк.
> С тех пор ошибки в программном и аппаратном обеспечении называют багами.
> Процесс отладки (то есть поиска ошибок) называется дебаг (_debug_) - если дословно, то "избавление от багов".

Сейчас любой программист обязан знать основные принципы отладки в современных средах разработки.

## Точка останова (breakpoint)

Когда мы запускаем программу, она начинает выполнять заложенные в неё действия довольно быстро.
Во время её выполнения мы не можем увидеть значения переменных, а также над какой конкретной операцией программа сейчас работает.
Всё усложняется многократно, если наша программа может работать в несколько потоков (но пока не будем об этом).

Для того, чтобы прервать и приостановить работу программы, были придуманы точки останова (_breakpoints_).
Их можно устанавливать в любом месте исходного кода, который может быть исполнен.
Например, на пустые строки ставить точки останова нельзя, а на операторы присвоения или цикла - можно.

![точка останова](/files/cw13-1.png)

> Внимание! Тут и далее примеры на снимках экрана сделаны на C#.
> Но пусть вас это не смущает - на C++ всё аналогично.

После запуска приложения в режиме отладки (обычно для этого используется клавиша `F5`) программа должна остановиться на выбранной строке:

![есть зохват!1](/files/cw13-2.png)

## Перемещение по отлаживаемому приложению

После того, как мы "поймали" выполнение программы в нужной строке, можно:
- продолжить выполнение программы ("выпустить" останов) - _Continue_;
- переместиться на следующую операцию в текущем методе - _Step over_;
- перейти внутрь вызова функции - _Step into_;
- выйти из текущей функции - _Step out_.

Действия по перемещению в исходном коде можно выполнить при помощи выделенных слева пунктов меню:

![полезные пункты меню](/files/cw13-3.png)

Например, выполним _Step over_ для нашего примера:

![тут могла быть ваша реклама](/files/cw13-4.png)

Как видно, теперь наша программа приостановилась на следующей строке.

Если мы захотим сделать _Step out_, то программа выполнит функцию `CreateRolesAsync` и остановится:

![пути дебага](/files/cw13-5.png)

Красным на рисунке отмечен ход выполнения операций в программе, зелёным - вызов и объявление функции `CreateRolesAsync`.

## Просмотр локальных переменных

Пока программа приостановлена в какой-либо точке, можно смотреть на значения переменных.
Для этого Вы можете либо навести мышь на название переменной, либо открыть окно _Locals_ (Debug -> Windows -> Locals, на снимке с меню Visual Studio выделено красным справа).

В отображаемом окне будут перечисленны все локальные переменные и их значения в момент приостановки приложения:

![локальные переменные](/files/cw13-6.png)

На снимке экрана можно видеть, что в переменной `adminEmail` содержится значение `admin@aisgorod.ru`, а в переменной `adminPassword` пока нет значения, т.к. программа ещё не выполнила соответствующую команду.

## Выполнение задания

Чтобы самостоятельно позаниматься отладкой приложения, его необходимо написать.

Предлагается создать консольное приложение на языке C++.

В Visual Studio это делается через мастер "Создать проект", после чего необходимо выбрать язык C++ и тип приложения "Консольное приложение".

В тексте программы над методом `main` необходимо создать свой метод, который на вход принимает два `unsigned char` - `a` и `b`.
На выходе метод ничего не возвращает (то есть `void`).

> Как создавать методы в C/C++ описано в [лабораторной работе 4 прошлого семестра](../cw04/README.md).

В тело метода необходимо скопировать пример из [л/р №2 этого семеста](../cw12/README.md) без объявления переменных `a` и `b`.
Эти переменные теперь будут приходить на вход Вашего метода.

Если Вы всё сделали правильно, в текущий момент времени программа должна запускаться без ошибок.

После того, как Вы исправите все ошибки, в методе `main` необходимо создать два вложенных друг в друга цикла `for` с параметрами типа `unsigned char`.

Если обозначить **номер вашего варианта** за `n`, то во внешнем цикле параметр должен изменяться от `n` до `n+2` с шагом `+1`.
Во внутреннем цикле параметр должен изменяться от `100+n` до `90+n` с шагом `-3`.

> Цикл `for` описан в [лабораторной работе 3 прошлого семестра](../cw03/README.md).

В теле цикла должен вызываться описанный ранее метод.
В качестве аргументов необходимо использовать параметры циклов.

Если Вы всё сделали правильно, то программа должна запуститься без ошибок и вывести в терминал много текста.

После того, как Вы исправите все ошибки, необходимо поставить точку останова внутрь Вашего метода (желательно ближе к концу).

При помощи окна _Locals_ и действия _Step over_ заполнить следующую таблицу трассировки:

| a   | b   | a ИЛИ b | a XOR b | НЕ a |
| --- | --- | ------- | ------- | ---- |
| ... | ... | ...     | ...     | ...  |
| ... | ... | ...     | ...     | ...  |
| ... | ... | ...     | ...     | ...  |
| ... | ... | ...     | ...     | ...  |

> Кстати, для установки точки останова в текущей строке можно использовать клавишу `F9`.
> Для перехода на следующий шаг (_step over_) - `F10`.

Таблицу можно заполнить как на бумаге, так и при помощи офисного пакета на компьютере.

На защите преподавателем проверяется следующее:
- программа написана правильно;
- программа запускается и выводит значения;
- таблица трассировки заполнена правильно (должно быть не менее 9 строк);
- студент может продемонстрировать работу по получению данных для таблицы трассировки.
